/**
 * Loading Page
 * Render this component while we are still loading the references
 * after the user logged in
 */
import React from 'react';
import PropTypes from 'prop-types';
import { connect } from 'react-redux';
import { compose } from 'redux';

import PageWrap from 'components/PageWrap';
import Header from 'components/Header';
import Footer from 'components/Footer';
import Main from 'components/Main';
import PageLoading from 'components/LoadingIndicator/PageLoading';

import {
  retrieveDataRefs,
} from './actions';

class LoadingPage extends React.PureComponent {
  componentDidMount = () => {
    // Data References
    this.props.getDataRefs();
  }

  render() {
    return (
      <PageWrap>
        <Header />
        <Main>
          <PageLoading>
            <div>
              <div className="rocket">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 226.83 271.21">
                  <g className="rocket__circle" data-name="Rocket Circle">
                    <path d="M184.38,173.05v12.24a3.8,3.8,0,0,0-.24.72c-.59,4.07-.9,8.2-1.79,12.2Q174,235.56,142,256.58a88.78,88.78,0,0,1-38.74,13.95l-5.52.68H86.46a2.72,2.72,0,0,0-.62-.23c-2.46-.27-4.94-.42-7.38-.8a91.7,91.7,0,0,1-45.75-20.76c-26.17-22-38.15-57.58-30.36-90.77,5.67-24.2,19-43.19,39.72-56.89a89,89,0,0,1,39.14-14.2c1.67-.2,3.34-.45,5-.67H98a3.63,3.63,0,0,0,.6.22c4.74.71,9.55,1.06,14.19,2.15,25.13,5.92,44.51,20,58.16,41.88A88.54,88.54,0,0,1,183.71,168C183.91,169.71,184.16,171.37,184.38,173.05Z"/>
                  </g>
                  <g className="rocket__cloud" data-name="Rocket Clouds">
                    <path stroke="#eef3f6" d="M101.82,271.21H82.62c-.23-.16-.44-.42-.69-.47-3.6-.62-7.24-1-10.8-1.84a89.56,89.56,0,0,1-23.91-9.25,88.33,88.33,0,0,1-16.68-11.92,93.93,93.93,0,0,1-11.4-12.26A87.78,87.78,0,0,1,5,209.14c-1.65-5.09-2.74-10.38-3.92-15.61a56.4,56.4,0,0,1-.77-6.38c-.09-.8.25-1.24,1.09-1.14a19,19,0,0,1,3.05.44A1.48,1.48,0,0,0,6,186.19c4.39-3.37,9.27-4.56,14.62-2.83a59.48,59.48,0,0,1,6,2.65,42.2,42.2,0,0,1,3.48-2.71,21.41,21.41,0,0,1,9.27-3.54l1.44-.47H44.7a3.72,3.72,0,0,0,.94.46c.9.17,1.83.18,2.7.41A24.09,24.09,0,0,1,59,186.29a21.6,21.6,0,0,1,6.8,16.28,2,2,0,0,0,1.34,2.13,10.12,10.12,0,0,1,5.43,12.5c-.24.83-.1,1.08.75,1.29A11.6,11.6,0,0,1,79,221.35a13.93,13.93,0,0,1,3.61,6.37c.23.84.52,1,1.42.86a65.26,65.26,0,0,1,9.3-1.23c5.45-.13,9.76,2.42,13,6.65a16,16,0,0,1,3.44,11.34c-.4,5.11-2.32,9.28-6.4,12.44a7.47,7.47,0,0,0-.85.92c.15.2.21.33.3.37.29.13.6.23.9.34,3.79,1.37,6.61,3.7,7.71,7.76.08.27.46.45.69.68v1.44c-2.81.44-5.63.87-8.44,1.34A14.52,14.52,0,0,0,101.82,271.21Z"/>
                  </g>
                  <g className="rocket__lines" data-name="Rocket Lines">
                    <path d="M111,183.13c-1.75,3.57-3.48,7.15-5.26,10.71-1.63,3.28-3.33,6.52-5,9.79q-4.08,8.1-8.13,16.2c-1.58,3.17-3.22,6.31-4.72,9.52a2.5,2.5,0,0,1-2.16,1.55,2.92,2.92,0,0,0-.93.47H82.86c.8-1.59,1.53-3.21,2.4-4.75,2.1-3.74,4.26-7.44,6.4-11.16q6.53-11.31,13-22.63c1.73-3,3.44-6,5.16-9a5.1,5.1,0,0,1,.59-.73Z"/>
                    <path d="M105.9,183.37c-1.36,2.65-2.71,5.3-4.1,7.94-1.1,2.11-2.25,4.2-3.37,6.3q-6,11.28-12,22.55c-1.2,2.25-2.35,4.52-3.53,6.78-.27.51-.6,1-1,1.69a23.79,23.79,0,0,1-1.65-3.1,2.36,2.36,0,0,1,.33-1.73c2.34-3.93,4.74-7.83,7.14-11.73,2.76-4.5,5.56-9,8.31-13.51s5.56-9.19,8.35-13.78c.3-.5.7-.94,1-1.42Z"/>
                    <path d="M49.65,183.23c.32-.37.5-.63.72-.84q6.9-6.55,13.81-13.09c2.32-2.19,4.68-4.34,7-6.53,3.25-3.07,6.48-6.16,9.72-9.23a.78.78,0,0,1,.75-.17c-.58.7-1.13,1.44-1.75,2.11q-5.54,5.93-11.09,11.82c-2.21,2.36-4.42,4.71-6.6,7.09s-4.08,4.56-6.14,6.81c-1,1.08-2,2.12-3.12,3.11a1.27,1.27,0,0,1-1.1.2A19.79,19.79,0,0,1,49.65,183.23Z"/>
                    <path d="M80,161.29c-1.09,1.36-2.13,2.76-3.27,4.08-3.19,3.71-6.41,7.38-9.63,11.06l-6.9,7.89c-1.11,1.28-2.21,2.58-3.38,4l-2.51-2.09c.36-.37.62-.67.9-1q9.48-9.48,19-19c1.81-1.79,3.71-3.49,5.56-5.23Z"/>
                    <path d="M88.15,182.18c-1.56,2.47-3.11,4.95-4.7,7.4-3,4.6-6,9.18-9,13.77-1.07,1.63-2.07,3.3-3.18,4.91-.21.31-.94.68-1.1.57-.59-.42-1-1-.48-1.83l6.13-8.51L86,184.35c.58-.82,1.19-1.63,1.79-2.44Z"/>
                    <path d="M84.79,180.49q-4.26,6.12-8.5,12.24c-2.84,4.12-5.66,8.27-8.52,12.38-.24.34-.73.74-1.07.71-1.14-.09-1.34-.76-.6-1.73l14.14-18.45c1.19-1.55,2.37-3.1,3.57-4.63a3.7,3.7,0,0,1,.73-.53Z"/>
                  </g>
                  <g className="rocket__ship" data-name="Rocketship">
                    <path d="M95.69,111.48c6.56-2.81,13.1-5.66,19.69-8.42,2.18-.91,3.48-2.75,5-4.37,8.29-9,15.5-18.92,23-28.6,6.67-8.64,13.4-17.23,20.3-25.69,5-6.17,11.34-11,17.92-15.42A274.86,274.86,0,0,1,217.89,8.61a5.76,5.76,0,0,0,1.72-1.4,28,28,0,0,0,2.29-2.92,2,2,0,0,0,.27-1.38,2.42,2.42,0,0,1,2-2.89,2.5,2.5,0,0,1,2.66,2.06,2.42,2.42,0,0,1-2.38,2.59,1.27,1.27,0,0,0-1.34.64c-.81,1-1.66,2.05-2.42,3.13a4.52,4.52,0,0,0-.69,1.61,286,286,0,0,1-10.35,38.27c-2.47,7-5.11,13.9-9.33,20-4.49,6.51-9.26,12.83-14.12,19.07-7.33,9.39-14.95,18.56-22.26,28-3.54,4.57-6.63,9.5-10,14.21a9.71,9.71,0,0,0-1.28,4.28q-1.54,9.1-3.08,18.19a5.21,5.21,0,0,0-.13,1.39,99,99,0,0,1,17.37-9.15c-.17,1-.29,1.84-.44,2.67-1.36,7.44-3.29,14.74-7.09,21.33-2.76,4.8-5.88,9.42-9.08,13.95-4.29,6.07-8.82,12-13.24,18-.12.15-.22.32-.37.53l1.53,1.27L135,206.05c-.74-.58-1.43-1.05-2-1.61s-.95-.4-1.52,0c-4.46,3.45-8.82,7-13.47,10.2-3.1,2.11-6.63,3.6-10,5.36-.09.05-.22,0-.55,0,.43-2.07.81-4.08,1.27-6.07,1.53-6.55,4.62-12.48,7.28-18.59.43-1,1.3-2,1.16-2.93s-1.4-1.38-2.16-2.06c-.08-.08-.15-.18-.31-.36l3.1-4,1.54,1c.92-1.13,1.84-2.23,2.7-3.37a1.09,1.09,0,0,0,.11-.87c-1.23-3.85-2.42-7.71-3.77-11.52-1.28-3.59-3.6-6.11-7.65-6.44a20.07,20.07,0,0,0-7.27,1.16c-2.13.61-4.28,1.22-6.45,1.62-1.57.29-2.41-.39-2.5-2-.1-2,0-4,.1-6.07.09-2.74.28-5.5-.71-8.15-1.3-3.45-4-5.09-7.5-5.46-4.26-.45-8.54-.65-12.81-.93a.91.91,0,0,0-.67.3c-.86,1.1-1.69,2.22-2.57,3.39l1.48,1.27-3.18,4.06L65.84,152C58,158,50.7,164.7,41.17,168.19c1.06-10,5.87-18.7,9.79-27.83l-2.72-2.17,3.16-4L53,135.23c.84-1,1.64-2.06,2.48-3,6.48-7.61,12.91-15.26,19.47-22.79,6.34-7.28,14.41-12.14,23.13-16,.75-.34,1.52-.64,2.58-1.08-.55,2.65-.91,5.11-1.57,7.48-1.08,3.87-2.35,7.69-3.54,11.54l-.13.16Zm94.67-51.69a10.8,10.8,0,0,0-10.61-10.9A10.94,10.94,0,1,0,180,70.76,10.81,10.81,0,0,0,190.36,59.79ZM63.23,149.93l-9.46-7.41c-2.39,5.74-4.77,11.35-6.12,17.31l.29.31ZM114,211.87a102.61,102.61,0,0,0,15.41-10.16l-9.26-7.23C117.73,200.2,115.37,205.74,114,211.87Z"/>
                  </g>
                </svg>
              </div>
              <div className="loading-text">
                <h1>{this.props.error ? 'Error' : 'Loading...'}</h1>
                {this.props.error
                  ? <p>We encountered an error on your connection.<br />Please contact your IT support to check your connectivity.</p>
                  : <p>{this.props.half ? 'Preparing your landing page...' : 'Checking all systems before we launch'}</p>
                }
              </div>
            </div>
          </PageLoading>
        </Main>
        <Footer />
      </PageWrap>
    );
  }
}

LoadingPage.propTypes = {
  half: PropTypes.oneOfType([
    PropTypes.bool,
    PropTypes.array,
  ]),
  error: PropTypes.oneOfType([
    PropTypes.bool,
    PropTypes.object,
  ]),
  getDataRefs: PropTypes.func,
};

function mapDispatchToProps(dispatch) {
  return {
    getDataRefs: () => dispatch(retrieveDataRefs()),
  };
}

const withConnect = connect(null, mapDispatchToProps);

export default compose(
  withConnect,
)(LoadingPage);
